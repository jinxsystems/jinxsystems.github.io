<!DOCTYPE html>
<html>
  <head>
    <title>ChatHer</title>
    <style>
      #click-count {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 16px;
      }

      #users-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .user-image {
        width: 100px;
        height: 100px;
        margin-bottom: 10px;
        position: relative;
      }

      .user-image img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
      }

      .user-details-small {
        position: absolute;
        bottom: 5px;
        font-size: 12px;
        color: white;
      }

      .age {
        left: 5px;
      }

      .new {
        right: 5px;
      }

      #user-details {
        width: 100%;
        height: 300px;
        margin-top: 20px;
        border: 1px solid #ccc;
        overflow-y: scroll; /* Add scrollbar for overflowing content */
      }

      #pagination {
        margin-top: 20px;
        text-align: center;
      }

      #clicked-users-list {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: white;
        border: 1px solid #ccc;
        padding: 10px;
        display: none;
        /* Initially hidden */
      }

      #clicked-users-list.show {
        display: block;
        /* Display when active */
      }

      #clicked-users-list img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 5px;
      }
    /* Basic styling - customize as needed */
    #search-container {
        margin-bottom: 20px;
    }
    #user-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive grid */
        gap: 20px;
    }
    .user-card {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
        cursor: pointer; /* Add cursor style for better user experience */
    }
    .user-card img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
    }
    #user-popup {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: white;
        border: 1px solid #ccc;
        padding: 10px;
        display: none; /* Initially hidden */
    }
    #user-popup img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
    }
    /* Styles for the clicked users list */
    #clicked-users-list {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: white;
        border: 1px solid #ccc;
        padding: 10px;
        display: none; /* Initially hidden */
    }
    #clicked-users-list.show {
        display: block; /* Display when active */
    }
    #clicked-users-list img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 5px;
        cursor: pointer; /* Add cursor style for better user experience */
    }
</style>
  </head>
  <body>
    <div id="search-container">
    <input type="text" id="search-bar" placeholder="Search users...">
    <div id="search-results"></div>
    </div>

    <div id="iframe-container">
    <iframe id="user-iframe" src="" width="100%" height="300px"></iframe>
    </div>

    <div id="user-grid"></div>

    <div id="pagination">
    <button id="prev-page">Previous</button>
    <button id="next-page">Next</button>
    </div>

    <div id="user-popup">
    <img id="most-selected-user" src="" alt="Most Selected User">
    </div>

    <div id="clicked-users-list"></div>
    <script>
      const userGrid = document.getElementById('user-grid');
      const userIframe = document.getElementById('user-iframe');
      const mostSelectedUserImg = document.getElementById('most-selected-user');
      const userPopup = document.getElementById('user-popup');
      const usersContainer = document.getElementById('users-container');
      const userDetailsDiv = document.getElementById('user-details');
      const prevPageButton = document.getElementById('prev-page');
      const nextPageButton = document.getElementById('next-page');
      const clickCountDiv = document.getElementById('click-count');
      const clickedUsersList = document.getElementById('clicked-users-list');

      const usersPerPage = 25;
      let currentPage = 1;
      let usersData = [];
      let clickCount = 0;

      // Sample JSON response data (replace with your actual API call)
      const usersDataPromise = fetch('https://chaturbate.com/api/public/affiliates/onlinerooms/?wm=9cg6A&client_ip=request_ip')
        .then(response => response.json())
        .then(data => {
          usersData = data.results;
          displayUsers();
        });

      // Function to display users in the grid
      function displayUsers(usersToDisplay) {
          userGrid.innerHTML = ''; // Clear previous users
    
          usersToDisplay.forEach(user => {
          const userCard = document.createElement('div');
          userCard.classList.add('user-card');
          userCard.innerHTML = `
              <img src="${user.imgSrc}" alt="${user.name}">
              <h3>${user.name}</h3>
          `;
          userCard.addEventListener('click', () => {
              handleUserClick(user.id);
              userIframe.src = user.iframeSrc; // Load iframe
          });
          userGrid.appendChild(userCard);
          });
      }

      function _displayUsers() {
        const startIndex = (currentPage - 1) * usersPerPage;
        const endIndex = startIndex + usersPerPage;
        const usersToDisplay = usersData.slice(startIndex, endIndex);

        usersContainer.innerHTML = '';

        usersToDisplay.forEach(user => {
          const userDiv = document.createElement('div');
          userDiv.classList.add('user-image');

          const image = document.createElement('img');
          image.src = user.image_url;
          image.addEventListener('click', () => {
            clickCount++;
            clickCountDiv.textContent = clickCount;

            // Display all user data in the div
            userDetailsDiv.innerHTML = `
              <h2>${user.username}</h2>
              <p>Gender: ${user.gender}</p>
              <p>Location: ${user.location}</p>
              <p>Current Show: ${user.current_show}</p>
              <p>Room Subject: ${user.room_subject}</p>
              <p>Tags: ${user.tags.join(', ')}</p>
              <p>Is New: ${user.is_new}</p>
              <p>Number of Users: ${user.num_users}</p>
              <p>Number of Followers: ${user.num_followers}</p>
              <p>Country: ${user.country}</p>
              <p>Spoken Languages: ${user.spoken_languages}</p>
              <p>Display Name: ${user.display_name}</p>
              <p>Birthday: ${user.birthday}</p>
              <p>Is HD: ${user.is_hd}</p>
              <p>Age: ${user.age}</p>
              <p>Seconds Online: ${user.seconds_online}</p>
              <p>Image URL: ${user.image_url}</p>
              <p>Chat Room URL: ${user.chat_room_url}</p>
            `;

            saveClickedUser(user);
            displayClickedUsers();
          });

          const ageSpan = document.createElement('span');
          ageSpan.classList.add('user-details-small', 'age');
          ageSpan.textContent = user.age;

          const newSpan = document.createElement('span');
          newSpan.classList.add('user-details-small', 'new');
          newSpan.textContent = user.is_new ? 'New' : '';

          userDiv.appendChild(image);
          userDiv.appendChild(ageSpan);
          userDiv.appendChild(newSpan);
          usersContainer.appendChild(userDiv);
        });

        prevPageButton.disabled = currentPage === 1;
        nextPageButton.disabled = endIndex >= usersData.length;
      }

    // Function to handle user clicks
    function handleUserClick(userId) {
        const user = users.find(user => user.id === userId);
        if (user) {
        user.clicks++;
        // Update click count in local storage or server-side database
        // ... (Implementation for storing click data)

        updateMostSelectedUser();
        saveClickedUser(user);
        displayClickedUsers();
        }
    }

    // Function to update the most selected user in the popup
    function updateMostSelectedUser() {
        // Sort users by clicks in descending order
        const sortedUsers = users.slice().sort((a, b) => b.clicks - a.clicks);
        const mostSelectedUser = sortedUsers[0];

        if (mostSelectedUser) { // Check if there is a most selected user
        mostSelectedUserImg.src = mostSelectedUser.imgSrc;
        userPopup.style.display = 'block'; // Show the popup
        }
    }

    // Function to save clicked user to local storage
    function saveClickedUser(user) {
        let clickedUsers = JSON.parse(localStorage.getItem('clickedUsers')) || [];
        if (!clickedUsers.find(u => u.id === user.id)) {
        clickedUsers.push(user);
        localStorage.setItem('clickedUsers', JSON.stringify(clickedUsers));
        }
    }

    // Function to display clicked users in the list
    function displayClickedUsers() {
        clickedUsersList.innerHTML = '';
        let clickedUsers = JSON.parse(localStorage.getItem('clickedUsers')) || [];
        clickedUsers.forEach(user => {
        const userImage = document.createElement('img');
        userImage.src = user.imgSrc;
        userImage.addEventListener('click', () => {
            userIframe.src = user.iframeSrc; // Load iframe for clicked user
        });
        clickedUsersList.appendChild(userImage);
        });
        clickedUsersList.classList.add('show');
    }

      function _displayClickedUsers() {
        clickedUsersList.innerHTML = '';
        let clickedUsers = JSON.parse(localStorage.getItem('clickedUsers')) || [];
        clickedUsers.forEach(user => {
          const userImage = document.createElement('img');
          userImage.src = user.image_url;
          userImage.addEventListener('click', () => {
            // Display all user data in the div
            userDetailsDiv.innerHTML = `
              <h2>${user.username}</h2>
              <p>Gender: ${user.gender}</p>
              <p>Location: ${user.location}</p>
              <p>Current Show: ${user.current_show}</p>
              <p>Room Subject: ${user.room_subject}</p>
              <p>Tags: ${user.tags.join(', ')}</p>
              <p>Is New: ${user.is_new}</p>
              <p>Number of Users: ${user.num_users}</p>
              <p>Number of Followers: ${user.num_followers}</p>
              <p>Country: ${user.country}</p>
              <p>Spoken Languages: ${user.spoken_languages}</p>
              <p>Display Name: ${user.display_name}</p>
              <p>Birthday: ${user.birthday}</p>
              <p>Is HD: ${user.is_hd}</p>
              <p>Age: ${user.age}</p>
              <p>Seconds Online: ${user.seconds_online}</p>
              <p>Image URL: ${user.image_url}</p>
              <p>Chat Room URL: ${user.chat_room_url}</p>
            `;
          });
          clickedUsersList.appendChild(userImage);
        });
        clickedUsersList.classList.add('show');
      }

  // Pagination functionality
  function paginateUsers() {
    const startIndex = (currentPage - 1) * usersPerPage;
    const endIndex = startIndex + usersPerPage;
    const usersToDisplay = users.slice(startIndex, endIndex);
    displayUsers(usersToDisplay);

    prevPageButton.disabled = currentPage === 1;
    nextPageButton.disabled = endIndex >= users.length;
  }

  prevPageButton.addEventListener('click', () => {
    currentPage--;
    paginateUsers();
  });

  nextPageButton.addEventListener('click', () => {
    currentPage++;
    paginateUsers();
  });

  // Initial display of users (with pagination)
  paginateUsers();

    </script>
  </body>
</html>
